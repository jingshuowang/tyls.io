<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI System Prototype</title>
    <style>
        body {
            background-color: #333;
            /* Dark background to see the UI clearly */
            background-image: linear-gradient(45deg, #444 25%, transparent 25%),
                linear-gradient(-45deg, #444 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #444 75%),
                linear-gradient(-45deg, transparent 75%, #444 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* 
           The 9-Slice Frame Container 
           This element will have the border-image and the blur effect.
        */
        .ui-frame {
            position: relative;

            /* Dimensions (can be dynamic) */
            width: 400px;
            height: 300px;

            /* 
               9-Slice Border Configuration 
               Replace 'url(...)' with your actual frame image.
               'slice' values (fill 10) depend on the image corner size.
            */
            border: 24px solid transparent;
            /* Width of the border */
            border-image-source: url('Assets/Image/ui_frame_placeholder.png');
            /* Placeholder */
            border-image-slice: 8 fill;
            /* 8px corners, 'fill' keeps the center */
            border-image-width: 24px;
            border-image-repeat: stretch;
            /* 'stretch' or 'round' or 'repeat' */

            /* Typography */
            color: white;
            padding: 20px;
            box-sizing: border-box;
            /* Include padding/border in width/height */
        }

        /* 
           Frosted Glass Effect (The "Blur" inside)
           Note: border-image 'fill' might cover this if the center isn't transparent.
           If the center of the image is transparent, we can add a background here.
        */
        .ui-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;

            /* The Blur Magic */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);

            /* Semi-transparent background tint */
            background-color: rgba(0, 0, 0, 0.5);

            /* Ensure text is above */
            z-index: -1;
        }

        /* Content layout inside the frame */
        .ui-inner {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        h2 {
            margin-top: 0;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        p {
            line-height: 1.5;
        }

        .btn {
            background: #555;
            border: 2px solid #777;
            color: white;
            padding: 10px;
            cursor: pointer;
            margin-top: auto;
            font-weight: bold;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #777;
        }

        /* Placeholder image generation (for testing only, remove when real image exists) */
        /* This is just so you see SOMETHING if the image is missing */
        .ui-frame.placeholder-mode {
            border: 4px solid #888;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            /* Rounded corners if not using 9-slice */
        }
    </style>
</head>

<body>

    <!-- UI Component Example -->
    <div class="ui-frame" id="testFrame">
        <!-- Background Blur Layer -->
        <div class="ui-content"></div>

        <!-- Actual UI Elements -->
        <div class="ui-inner">
            <h2>Inventory</h2>
            <p>Item: <strong>Lazor Pickaxe</strong></p>
            <p>Durability: 9000/9001</p>
            <p><i>"A shiny tool for a shiny person."</i></p>

            <button class="btn">Close</button>
        </div>
    </div>

    <script>
        // "Red Key" Processor
        // This script loads the frame image, looks for Pure Red (255,0,0),
        // and turns it transparent (so the backdrop-filter blur shows through).

        const frameUrl = 'Assets/Image/frame.png'; // Will look for this file

        const img = new Image();
        img.crossOrigin = "Anonymous";

        img.onload = function () {
            // Create a canvas to process the image
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;

            // Draw original image
            ctx.drawImage(img, 0, 0);

            // Get pixel data
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            let hasRed = false;

            // Scan for Red (255, 0, 0)
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                // Tolerance could be added, but user said "bright red"
                if (r > 240 && g < 10 && b < 10) {
                    data[i + 3] = 0; // Alpha = 0 (Transparent)
                    hasRed = true;
                }
            }

            if (hasRed) {
                console.log("Detected Red Mask! Applying chroma key...");
                ctx.putImageData(imageData, 0, 0);

                // Convert processed canvas to data URL
                const newUrl = canvas.toDataURL();

                // Apply to the frame
                const frameEl = document.getElementById('testFrame');
                frameEl.style.borderImageSource = `url('${newUrl}')`;
                frameEl.classList.remove('placeholder-mode');
            } else {
                console.log("No red mask found, using image as-is.");
                document.getElementById('testFrame').style.borderImageSource = `url('${frameUrl}')`;
            }
        };

        img.onerror = function () {
            console.warn("frame.png not found yet. waiting for upload...");
            // Keep placeholder styling defined in CSS
            document.getElementById('testFrame').classList.add('placeholder-mode');
            document.getElementById('testFrame').style.borderImageSource = 'none';
        };

        img.src = frameUrl;
    </script>

</body>

</html>